<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no"/>
<title>Amit's Nutrition Hub v8</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700;900&family=DM+Sans:ital,wght@0,400;0,500;0,700;1,400&display=swap" rel="stylesheet"/>
<style>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   AMIT'S NUTRITION HUB â€” V8
   Optimized: Mobile-First Grid, Sticky Nav, Touch Targets
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
:root{
  --sf:#E8671B; --sf2:#F9913E; --gr:#1A6B3C; --gr2:#2D9158;
  --cr:#FEF6EC; --tx:#1C1C1C; --mu:#767676; --bd:#EDE0D4; --bg:#FFFBF6;
  --blu:#1565C0; --pur:#6A1B9A; --fiber:#8D6E63;
  --radius-sm:10px; --radius-md:14px; --radius-lg:18px;
  --shadow-sm:0 2px 8px rgba(0,0,0,.06);
  --p-card:16px;
}

*{box-sizing:border-box;margin:0;padding:0; -webkit-tap-highlight-color: transparent;}
html{-webkit-text-size-adjust:100%;scroll-behavior:smooth;}
body{
  font-family:'DM Sans',sans-serif;
  background:var(--bg);
  min-height:100vh;
  color:var(--tx);
  padding:12px;
  font-size:14px;
  line-height:1.5;
  max-width:1200px;
  margin:0 auto;
}

/* â”€â”€ HEADER â”€â”€ */
.hdr{
  background:linear-gradient(135deg,var(--sf),#C94A10);
  border-radius:var(--radius-lg);
  padding:16px 20px;
  margin-bottom:12px;
  display:flex;
  align-items:center;
  gap:12px;
  box-shadow:0 6px 24px rgba(232,103,27,.25);
  position:relative;
  overflow:hidden;
}
.hdr::before{content:'';position:absolute;top:-50px;right:-50px;width:200px;height:200px;border-radius:50%;background:rgba(255,255,255,.06);}
.hdr-icon{font-size:32px;line-height:1;z-index:1;flex-shrink:0;}
.hdr-text{z-index:1;flex:1;min-width:0;}
.hdr-text h1{font-family:'Playfair Display',serif;font-size:clamp(18px,4vw,24px);color:#fff;font-weight:900;line-height:1.2;}
.hdr-text p{color:rgba(255,255,255,.9);font-size:12px;margin-top:2px;}

/* â”€â”€ STICKY TABS â”€â”€ */
.tab-nav-container {
  position: sticky;
  top: 0;
  z-index: 100;
  background: var(--bg);
  padding-top: 5px;
  padding-bottom: 10px;
  margin-left: -12px;
  margin-right: -12px;
  padding-left: 12px;
  padding-right: 12px;
}
.tab-nav{
  display:flex; gap:8px;
  overflow-x:auto; padding-bottom:4px; scrollbar-width:none;
}
.tab-nav::-webkit-scrollbar{display:none;}
.tab-btn{
  padding:9px 15px; border-radius:30px; border:1px solid var(--bd);
  background:#fff; font-size:13px; font-weight:700; cursor:pointer;
  color:var(--mu); white-space:nowrap; flex-shrink:0; transition:all .18s;
  box-shadow: 0 2px 4px rgba(0,0,0,0.03);
}
.tab-btn.active{background:var(--sf);color:#fff;border-color:var(--sf);box-shadow:0 3px 10px rgba(232,103,27,.3); transform: translateY(-1px);}
/* Custom Colors */
.tab-btn[data-t="bmi"].active{background:var(--blu);border-color:var(--blu);}
.tab-btn[data-t="budget"].active{background:var(--pur);border-color:var(--pur);}
.tab-btn[data-t="timing"].active{background:#00695C;border-color:#00695C;}

.tab-panel{display:none;animation:fadeIn 0.3s ease;}
.tab-panel.active{display:block;}
@keyframes fadeIn{from{opacity:0;transform:translateY(5px)}to{opacity:1;transform:translateY(0)}}

/* â”€â”€ UTILS â”€â”€ */
.card{background:#fff;border-radius:var(--radius-md);padding:var(--p-card);border:1px solid var(--bd);box-shadow:var(--shadow-sm);margin-bottom:14px;}
.sec-title{font-family:'Playfair Display',serif;font-size:17px;font-weight:700;color:var(--gr);margin-bottom:14px;display:flex;align-items:center;gap:6px;}

/* â”€â”€ CALCULATOR GRID â”€â”€ */
.calc-grid{display:flex;flex-direction:column;gap:14px;}
@media(min-width:900px){
  .calc-grid{display:grid;grid-template-columns:1.3fr 0.7fr;gap:20px;align-items:start;}
  body{padding:20px;}
}

/* â”€â”€ FOOD SELECTION â”€â”€ */
.search-wrap{position:relative;margin-bottom:12px;}
.search-wrap input{
  width:100%;padding:12px 12px 12px 40px;
  border:1.5px solid var(--bd);border-radius:var(--radius-sm);
  font-family:'DM Sans',sans-serif;font-size:16px; /* Prevents iOS Zoom */
  background:var(--cr);outline:none;
  transition: border-color 0.2s;
}
.search-wrap input:focus{border-color: var(--sf);}
.s-ico{position:absolute;left:14px;top:50%;transform:translateY(-50%);font-size:16px;}

.cat-scroll{display:flex;gap:8px;overflow-x:auto;padding-bottom:8px;margin-bottom:8px;scrollbar-width:none;}
.cat-chip{
  border:1.5px solid var(--bd);border-radius:20px;padding:6px 14px;
  font-size:12px;font-weight:600;cursor:pointer;white-space:nowrap;
  background:#fff;color:var(--mu);flex-shrink:0;
}
.cat-chip.active{background:var(--sf);color:#fff;border-color:var(--sf);}

/* RESPONSIVE FOOD GRID */
.food-grid{
  display:grid; 
  grid-template-columns: repeat(2, 1fr); /* Mobile: 2 cols */
  gap: 8px;
  margin-bottom:12px; 
  max-height:300px; 
  overflow-y:auto; 
  padding-right:2px;
}
@media(min-width:500px){ .food-grid{grid-template-columns:repeat(3,1fr);} } /* Large Phone */
@media(min-width:900px){ .food-grid{grid-template-columns:repeat(4,1fr); max-height: 400px;} } /* Desktop */

/* Custom scrollbar */
.food-grid::-webkit-scrollbar {width: 4px;}
.food-grid::-webkit-scrollbar-thumb {background: #ddd; border-radius: 4px;}

.food-card{
  border:1.5px solid var(--bd);border-radius:var(--radius-sm);
  padding:10px 6px;cursor:pointer;text-align:center;
  transition:all .15s;background:var(--cr);
  position: relative;
}
.food-card:active {transform: scale(0.96);}
.food-card.selected{border-color:var(--sf);background:#FFF0E0;box-shadow:0 0 0 2px rgba(232,103,27,.15);}
.food-card .em{font-size:26px;display:block;margin-bottom:6px;}
.food-card .fn{font-size:12px;font-weight:700;line-height:1.25;color:var(--tx);height:2.5em;overflow:hidden;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;}
.food-card .fp{font-size:11px;color:var(--gr);font-weight:700;margin-top:4px;}
.food-card .fib{font-size:10px;color:#8D6E63;}

/* â”€â”€ QTY & PREVIEW â”€â”€ */
.prev-bar{margin-bottom:12px;background:linear-gradient(135deg,#F0FFF5,#E6F7EE);border:1.5px solid #B5DFC5;border-radius:var(--radius-sm);padding:10px 14px;display:none;}
.prev-bar.vis{display:block;}
.prev-bar .pn{font-size:14px;font-weight:700;color:var(--gr);margin-bottom:6px;}
.prev-stats{display:flex;gap:12px;font-size:12px;color:var(--mu);flex-wrap: wrap;}
.prev-stats strong{color:var(--tx);font-weight:700;}

.qty-row{background:var(--cr);border-radius:var(--radius-sm);padding:12px;margin-bottom:12px;border:1.5px solid var(--bd);}
.qty-controls{display:flex;align-items:center;gap:10px;justify-content: center;}
.qty-inp{border:none;background:transparent;font-size:24px;font-weight:700;width:70px;text-align:center;font-family:'DM Sans',sans-serif;color:var(--tx);}
.qty-pm{width:36px;height:36px;border-radius:10px;border:2px solid var(--bd);background:#fff;font-weight:700;font-size:20px;cursor:pointer;display:flex;align-items:center;justify-content:center;color:var(--sf);}
.qty-pm:active{background:var(--sf);color:#fff;border-color:var(--sf);}

.qbtns{display:flex;gap:8px;margin-top:10px;overflow-x:auto;padding-bottom: 2px;}
.qb{background:#fff;border:1.5px solid var(--bd);border-radius:8px;padding:6px 12px;font-size:11px;font-weight:600;cursor:pointer;white-space:nowrap;}
.qb.qb-active{background:var(--sf);color:#fff;border-color:var(--sf);}

/* â”€â”€ TIPS BOX â”€â”€ */
.nutr-tip{
  background:linear-gradient(135deg,#FFF8E1,#FFF3E0);
  border:1.5px solid #FFD54F; border-radius:var(--radius-sm);
  padding:14px; margin-top:8px; margin-bottom:8px; display:none;
}
.nutr-tip.vis{display:block;}
.nutr-tip-title{font-size:11px;font-weight:800;text-transform:uppercase;color:#E65100;margin-bottom:6px;letter-spacing:0.5px;}
.nt-text{font-size:13px;color:#5D4037;line-height:1.5;}

.add-btn{
  width:100%;padding:15px; background:linear-gradient(135deg,var(--sf),#C94A10);
  color:#fff;border:none;border-radius:var(--radius-sm);
  font-size:16px;font-weight:700;cursor:pointer;
  box-shadow:0 4px 14px rgba(232,103,27,.3);
  transition:transform 0.1s;
}
.add-btn:active{transform:scale(0.98);}

/* â”€â”€ MY PLATE STATS â”€â”€ */
.stats-row{display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px;margin-bottom:14px;}
.stat-box{background:var(--cr);border-radius:var(--radius-sm);padding:12px 8px;border:1.5px solid var(--bd);text-align:center;}
.stat-box .lbl{font-size:10px;text-transform:uppercase;color:var(--mu);font-weight:700;}
.stat-box .val{font-family:'Playfair Display',serif;font-size:24px;font-weight:700;line-height:1;margin-top:4px;}
.stat-box .val.p{color:var(--gr);}
.stat-box .val.c{color:var(--sf);}
.stat-box .val.f{color:var(--fiber);}

.ml-items{max-height:300px;overflow-y:auto;margin-top:10px;}
.ml-entry{display:flex;align-items:center;gap:10px;padding:10px 0;border-bottom:1px dashed var(--bd);}
.me-if{flex:1;min-width:0;}
.me-nu{text-align:right;font-size:11px;}
.me-del{background:none;border:none;color:#ccc;font-size:20px;cursor:pointer;padding:0 8px;display:flex;align-items:center;height:100%;}
.me-del:active{color:red;}

/* â”€â”€ GAP ANALYSIS SECTION â”€â”€ */
.gap-analysis-card{background:linear-gradient(135deg,#E8F5E9,#C8E6C9);border:2px solid var(--gr);padding:18px;border-radius:var(--radius-md);margin-bottom:14px;}
.gap-form{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:12px;}
.gap-inp label{font-size:11px;font-weight:700;text-transform:uppercase;color:var(--gr);display:block;margin-bottom:6px;}
.gap-inp input, .gap-inp select{width:100%;padding:10px;border:1px solid #A5D6A7;border-radius:8px;font-family:inherit;font-size:16px;outline:none;background:#fff;}
.gap-calc-btn{grid-column:span 2;background:var(--gr);color:#fff;border:none;padding:14px;border-radius:8px;font-weight:700;cursor:pointer;font-size:15px;box-shadow:0 3px 10px rgba(0,0,0,0.1);}
.gap-result{display:none;margin-top:14px;padding-top:14px;border-top:1px dashed var(--gr);}
.gap-result.vis{display:block;}
.gap-msg{font-size:15px;font-weight:700;color:#1B5E20;margin-bottom:10px;}
.gap-sug-list{display:flex;flex-direction:column;gap:8px;}
.gap-sug-item{background:#fff;padding:12px;border-radius:10px;font-size:13px;display:flex;align-items:center;gap:12px;border:1px solid #A5D6A7;box-shadow:0 2px 5px rgba(0,0,0,0.05);}

/* â”€â”€ BUDGET PLANS â”€â”€ */
.budget-grid{display:grid;grid-template-columns:1fr;gap:14px;}
@media(min-width:600px){.budget-grid{grid-template-columns:1fr 1fr;}}
.budget-card{border:2px solid var(--bd);border-radius:var(--radius-md);overflow:hidden;}
.bc-hdr{padding:12px;color:#fff;font-weight:700;text-align:center;font-size:15px;}
.bc-hdr.u120{background:linear-gradient(135deg,#00897B,#00695C);}
.bc-hdr.u200{background:linear-gradient(135deg,#5E35B1,#4527A0);}
.bc-body{padding:14px;background:#fff;}
.bc-row{display:flex;justify-content:space-between;font-size:13px;padding:8px 0;border-bottom:1px dashed #eee;}
.bc-total{margin-top:12px;padding-top:10px;border-top:2px solid #eee;font-weight:700;display:flex;justify-content:space-between;color:var(--tx);font-size:14px;}

/* â”€â”€ BMI â”€â”€ */
.bmi-input-group{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:14px;}
.bmi-res-box{text-align:center;padding:18px;background:var(--cr);border-radius:var(--radius-sm);margin-top:12px;display:none;}
.bmi-res-box.vis{display:block;}
.bmi-val{font-size:36px;font-weight:900;color:var(--blu);font-family:'Playfair Display',serif;}

/* Toast */
.toast{position:fixed;bottom:20px;left:50%;transform:translateX(-50%) translateY(80px);background:#333;color:#fff;padding:12px 24px;border-radius:30px;font-size:14px;font-weight:600;transition:transform .3s;z-index:999;box-shadow: 0 4px 12px rgba(0,0,0,0.2);}
.toast.show{transform:translateX(-50%) translateY(0);}
</style>
</head>
<body>

<div class="hdr">
  <div class="hdr-icon">ğŸ¥—</div>
  <div class="hdr-text">
    <h1>Amit's Nutrition Hub</h1>
    <p>Track. Analyze. Build Muscle.</p>
  </div>
</div>

<div class="tab-nav-container">
  <div class="tab-nav">
    <button class="tab-btn active" onclick="switchTab('calc',this)">ğŸ½ï¸ Plate Calc</button>
    <button class="tab-btn" onclick="switchTab('diet',this)">ğŸ“Š My Diet & Analysis</button>
    <button class="tab-btn" data-t="budget" onclick="switchTab('budget',this)">ğŸ’° Budget Diets</button>
    <button class="tab-btn" data-t="bmi" onclick="switchTab('bmi',this)">âš–ï¸ BMI</button>
    <button class="tab-btn" data-t="timing" onclick="switchTab('timing',this)">â° Timing</button>
  </div>
</div>

<!-- ============ CALCULATOR TAB ============ -->
<div class="tab-panel active" id="tab-calc">
  <div class="calc-grid">
    <!-- LEFT: Food Selector -->
    <div class="card">
      <div class="sec-title">ğŸ¥˜ Build Your Plate</div>
      <div class="search-wrap">
        <span class="s-ico">ğŸ”</span>
        <input type="text" id="searchInput" placeholder="Search (e.g. Rajma, Banana)..." oninput="filterFoods()"/>
      </div>
      <div class="cat-scroll" id="catScroll"></div>
      
      <!-- GRID: RESPONSIVE COLUMNS -->
      <div class="food-grid" id="foodGrid"></div>

      <!-- Preview Selected Item -->
      <div class="prev-bar" id="prevBar">
        <div class="pn" id="prevName"></div>
        <div class="prev-stats">
          <span>Prot: <strong id="prevP">0g</strong></span>
          <span>Cal: <strong id="prevC">0</strong></span>
          <span>Fib: <strong id="prevF">0g</strong></span>
        </div>
      </div>

      <!-- Qty Controls -->
      <div class="qty-row">
        <div class="qty-controls">
          <button class="qty-pm" onclick="adjQty(-1)">âˆ’</button>
          <input type="number" class="qty-inp" id="weightInput" value="100"/>
          <span style="font-size:12px;color:var(--mu);width:30px" id="qtyUnit">g</span>
          <button class="qty-pm" onclick="adjQty(1)">+</button>
        </div>
        <div class="qbtns" id="quickBtns"></div>
      </div>

      <!-- Nutrition Tip -->
      <div class="nutr-tip" id="nutrTip">
        <div class="nutr-tip-title">ğŸ’¡ Why it's nutritious</div>
        <div class="nt-text" id="nutrTipText"></div>
      </div>

      <button class="add-btn" onclick="addToMeal()">+ Add to Plate</button>
    </div>

    <!-- RIGHT: My Plate Summary -->
    <div class="card">
      <div class="sec-title">ğŸ½ï¸ Current Plate</div>
      <div class="stats-row">
        <div class="stat-box">
          <div class="lbl">Protein</div>
          <div class="val p" id="totalP">0</div>
          <div class="lbl">grams</div>
        </div>
        <div class="stat-box">
          <div class="lbl">Calories</div>
          <div class="val c" id="totalC">0</div>
          <div class="lbl">kcal</div>
        </div>
        <div class="stat-box">
          <div class="lbl">Fiber</div>
          <div class="val f" id="totalF">0</div>
          <div class="lbl">grams</div>
        </div>
      </div>

      <div class="ml-items" id="mealItems">
        <div style="text-align:center;padding:30px;color:var(--mu);font-size:13px">
          Your plate is empty.<br>Select a food to start.
        </div>
      </div>

      <!-- ANALYZE BUTTON -->
      <button class="add-btn" id="analyzeBtn" onclick="analyzeAndLog()" style="display:none;margin-top:14px;background:#1A6B3C;">
        ğŸ“ Analyze & Calculate Gap
      </button>
    </div>
  </div>
</div>

<!-- ============ MY DIET & ANALYSIS TAB ============ -->
<div class="tab-panel" id="tab-diet">
  
  <div class="card">
    <div class="sec-title">ğŸ“… Meal Analysis Log</div>
    <div id="dailyLogContainer" style="margin-bottom:10px">
      <div style="text-align:center;color:var(--mu);font-size:13px;padding:15px;">No meals logged yet. Go to Plate Calc to add.</div>
    </div>
    <div style="border-top:1px dashed var(--bd);padding-top:12px;display:flex;justify-content:space-between;font-weight:700;font-size:14px;">
      <span>Total Logged Protein:</span>
      <span style="color:var(--gr)" id="logTotalP">0g</span>
    </div>
  </div>

  <!-- GAP ANALYSIS -->
  <div class="gap-analysis-card">
    <div class="sec-title" style="color:#1B5E20">ğŸ¯ Personalized Protein Gap</div>
    <div class="gap-form">
      <div class="gap-inp">
        <label>Your Weight (kg)</label>
        <input type="number" id="gapWeight" placeholder="e.g. 70" value="70">
      </div>
      <div class="gap-inp">
        <label>Diet Type</label>
        <select id="gapDiet">
          <option value="Non-Veg">Non-Veg</option>
          <option value="Veg">Vegetarian</option>
          <option value="Egg">Eggetarian</option>
        </select>
      </div>
      <button class="gap-calc-btn" onclick="calcGap()">Calculate My Protein Gap</button>
    </div>

    <div class="gap-result" id="gapResult">
      <div class="gap-msg" id="gapMsg"></div>
      <div style="font-size:11px;font-weight:700;color:var(--mu);margin-bottom:8px;text-transform:uppercase;">Eat these to hit your goal:</div>
      <div class="gap-sug-list" id="gapSugList"></div>
    </div>
  </div>
</div>

<!-- ============ BUDGET DIETS TAB ============ -->
<div class="tab-panel" id="tab-budget">
  <div class="card">
    <div class="sec-title">ğŸ’° High Protein Budget Plans</div>
    <p style="font-size:13px;color:var(--mu);margin-bottom:12px">Optimized for maximum protein per rupee.</p>
    <div style="display:flex;gap:10px;margin-bottom:16px;justify-content:center;">
      <button class="cat-chip active" onclick="renderBudget('Veg', this)">Veg</button>
      <button class="cat-chip" onclick="renderBudget('Egg', this)">Eggetarian</button>
      <button class="cat-chip" onclick="renderBudget('Non-Veg', this)">Non-Veg</button>
    </div>
    
    <div class="budget-grid" id="budgetContainer">
      <!-- Injected by JS -->
    </div>
  </div>
</div>

<!-- ============ BMI CALCULATOR TAB ============ -->
<div class="tab-panel" id="tab-bmi">
  <div class="card">
    <div class="sec-title">âš–ï¸ BMI Calculator</div>
    <div class="bmi-input-group">
      <div class="gap-inp">
        <label>Weight (kg)</label>
        <input type="number" id="bmiW" placeholder="70">
      </div>
      <div class="gap-inp">
        <label>Height (cm)</label>
        <input type="number" id="bmiH" placeholder="175">
      </div>
    </div>
    <button class="gap-calc-btn" style="background:var(--blu)" onclick="calcBMI()">Check BMI</button>
    
    <div class="bmi-res-box" id="bmiResultBox">
      <div class="bmi-val" id="bmiVal">22.5</div>
      <div style="font-weight:700;margin-top:5px;color:var(--tx)" id="bmiCat">Normal Weight</div>
      <p style="font-size:13px;color:var(--mu);margin-top:8px;line-height:1.4" id="bmiMsg"></p>
    </div>
  </div>
</div>

<!-- ============ TIMING TAB (NEW BIFURCATION) ============ -->
<div class="tab-panel" id="tab-timing">
  <div class="card">
    <div class="sec-title">â° Optimal Meal Timing</div>
    <p style="font-size:13px;color:var(--mu);margin-bottom:12px">Select your diet preference to see the best timing schedule.</p>
    
    <div style="display:flex;gap:10px;margin-bottom:14px;justify-content:center;">
      <button class="cat-chip active" onclick="renderTiming('Veg', this)">Vegetarian</button>
      <button class="cat-chip" onclick="renderTiming('Egg', this)">Eggetarian</button>
      <button class="cat-chip" onclick="renderTiming('Non-Veg', this)">Non-Veg</button>
    </div>

    <div id="timingContainer">
      <!-- Content injected by JS -->
    </div>
  </div>
</div>

<div class="toast" id="toast"></div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DATA
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const categories = ['All','Protein','North Indian','South Indian','Street Food','Chinese/Momos','Breads','Fruits','Snacks','Beverages'];

/* Data format: p=Protein, k=Calories (kcal), f=Fiber, veg=Type
  Sorted: Heroes first, then others.
*/
const foodData = [
  // â”€â”€ HERO ITEMS (DISPLAYED FIRST) â”€â”€
  {name:"Rajma (Cooked)", em:"ğŸ«˜", p:8.7, k:127, f:6.4, mode:'gram', cat:'Protein', veg:'Veg', tip:"High Fiber (6.4g) + Protein. Best eaten at lunch for sustained energy."},
  {name:"Milk (Buffalo/Full)", em:"ğŸ¥›", p:3.8, k:100, f:0, mode:'ml', cat:'Beverages', veg:'Veg', tip:"High calcium and quality protein. Best before bed."},
  {name:"Chickpeas (Chole)", em:"ğŸ¥£", p:9, k:164, f:8, mode:'gram', cat:'Protein', veg:'Veg', tip:"Great fiber and protein combo. Supports gut health."},
  {name:"Boiled Egg (Whole)", em:"ğŸ¥š", p:6.3, k:78, f:0, mode:'count', unit:'egg', cat:'Protein', veg:'Egg', tip:"Yolk contains Vitamin D & Choline. Best bioavailable protein source."},
  {name:"Egg White", em:"âšª", p:3.6, k:17, f:0, mode:'count', unit:'egg', cat:'Protein', veg:'Egg', tip:"Pure protein, zero fat. Eat 4-5 for a low calorie protein boost."},
  {name:"Chicken Breast", em:"ğŸ—", p:31, k:165, f:0, mode:'gram', cat:'Protein', veg:'Non-Veg', tip:"Highest protein density (31g/100g). Essential for muscle repair post-workout."},
  {name:"Whey Protein", em:"ğŸ¥¤", p:24, k:120, f:0, mode:'count', unit:'scoop', cat:'Protein', veg:'Veg', tip:"Fast absorption. Drink within 30 mins after gym for recovery."},
  {name:"Paneer (Raw)", em:"ğŸ§€", p:18, k:265, f:0, mode:'gram', cat:'Protein', veg:'Veg', tip:"Casein protein digests slowly. Eat at dinner to feed muscles while sleeping."},
  {name:"Fish (Tuna/Rohu)", em:"ğŸŸ", p:22, k:200, f:0, mode:'gram', cat:'Protein', veg:'Non-Veg', tip:"Rich in Omega-3 fatty acids. Reduces muscle soreness."},
  {name:"Soya Chunks", em:"ğŸŸ¤", p:52, k:345, f:13, mode:'gram', cat:'Protein', veg:'Veg', tip:"Highest plant protein (52g/100g). Cheap and effective muscle builder."},

  // â”€â”€ GRAINS & STAPLES â”€â”€
  {name:"Wheat Flour (Atta)", em:"ğŸŒ¾", p:12, k:340, f:11, mode:'gram', cat:'Breads', veg:'Veg', tip:"Basis of Roti. High fiber content compared to Maida."},
  {name:"Roti (Wheat)", em:"ğŸ«“", p:3, k:85, f:2.5, mode:'count', unit:'roti', cat:'Breads', veg:'Veg', tip:"Complex carb staple. 2 rotis provide ~5g fiber."},
  {name:"White Rice", em:"ğŸš", p:2.7, k:130, f:0.4, mode:'gram', cat:'Grains & Veg', veg:'Veg', tip:"Fast carbs. Perfect post-workout to spike insulin and absorb protein."},
  {name:"Brown Rice", em:"ğŸš", p:2.6, k:111, f:1.8, mode:'gram', cat:'Grains & Veg', veg:'Veg', tip:"Lower glycemic index than white rice. Good for lunch."},
  {name:"Bajra (Millet)", em:"ğŸ¥£", p:11, k:360, f:1.3, mode:'gram', cat:'Grains & Veg', veg:'Veg', tip:"Winter grain. Generates body heat and high satiety."},
  {name:"Ragi", em:"ğŸŒ¾", p:7.3, k:330, f:11.5, mode:'gram', cat:'Grains & Veg', veg:'Veg', tip:"Highest calcium grain. Excellent for bone health."},
  {name:"White Bread", em:"ğŸ", p:2, k:75, f:0.8, mode:'count', unit:'slice', cat:'Breads', veg:'Veg', tip:"Refined flour. Spikes blood sugar quickly."},
  {name:"Brown Bread", em:"ğŸ", p:2.5, k:75, f:1.5, mode:'count', unit:'slice', cat:'Breads', veg:'Veg', tip:"Check label - often just colored white bread."},
  {name:"Whole Wheat Bread", em:"ğŸ¥ª", p:3.3, k:72, f:2, mode:'count', unit:'slice', cat:'Breads', veg:'Veg', tip:"Good source of fiber and complex carbs."},
  {name:"Multigrain Bread", em:"ğŸŒ¾", p:4.5, k:85, f:2.5, mode:'count', unit:'slice', cat:'Breads', veg:'Veg', tip:"Seeds add slight protein and healthy fats."},
  {name:"Pav", em:"ğŸ¥¯", p:3.5, k:135, f:1, mode:'count', unit:'pc', cat:'Breads', veg:'Veg', tip:"Refined flour bun. Dense calories."},
  {name:"Kulcha (Plain)", em:"ğŸ«“", p:5, k:175, f:1, mode:'count', unit:'pc', cat:'Breads', veg:'Veg', tip:"Made of maida. Occasional treat."},
  {name:"Burger Bun", em:"ğŸ”", p:5, k:165, f:1, mode:'count', unit:'pc', cat:'Breads', veg:'Veg', tip:"Higher calorie than regular bread slices."},

  // â”€â”€ DALS (COOKED) â”€â”€
  {name:"Toor Dal (Cooked)", em:"ğŸ¥£", p:7.2, k:120, f:4.5, mode:'count', unit:'bowl', cat:'Protein', veg:'Veg', tip:"Standard daily protein source. Combine with rice."},
  {name:"Moong Dal (Cooked)", em:"ğŸ¥£", p:6.8, k:105, f:4.2, mode:'count', unit:'bowl', cat:'Protein', veg:'Veg', tip:"Lightest on stomach. Easy to digest."},
  {name:"Masoor Dal (Cooked)", em:"ğŸ¥£", p:9, k:130, f:5.5, mode:'count', unit:'bowl', cat:'Protein', veg:'Veg', tip:"High protein and cooks fast."},
  {name:"Chana Dal (Cooked)", em:"ğŸ¥£", p:6.5, k:135, f:5, mode:'count', unit:'bowl', cat:'Protein', veg:'Veg', tip:"Low GI dal. Good for diabetics."},

  // â”€â”€ NORTH INDIAN â”€â”€
  {name:"Dal Makhani", em:"ğŸ¥˜", p:11, k:400, f:8, mode:'count', unit:'bowl', cat:'North Indian', veg:'Veg', tip:"Tasty but high calorie due to butter/cream. Eat in moderation."},
  {name:"Kali Dal", em:"ğŸ¥£", p:9, k:200, f:6, mode:'count', unit:'bowl', cat:'North Indian', veg:'Veg', tip:"Lighter than Dal Makhani. Good protein & fiber source."},
  {name:"Chole Bhature", em:"ğŸ¥Ÿ", p:16.5, k:700, f:8, mode:'count', unit:'plate', cat:'North Indian', veg:'Veg', tip:"High calorie/fat meal. Treat meal."},
  {name:"Chole Kulche", em:"ğŸ¥™", p:13.5, k:500, f:8, mode:'count', unit:'plate', cat:'North Indian', veg:'Veg', tip:"Slightly better than bhature but still refined flour."},
  {name:"Chole Rice", em:"ğŸ›", p:11, k:400, f:7, mode:'count', unit:'plate', cat:'North Indian', veg:'Veg', tip:"Comfort food. Good fiber from chole."},

  // â”€â”€ SOUTH INDIAN â”€â”€
  {name:"Dosa (Plain)", em:"ğŸ¥", p:3.5, k:160, f:1, mode:'count', unit:'dosa', cat:'South Indian', veg:'Veg', tip:"Fermented batter is good for gut health."},
  {name:"Masala Dosa", em:"ğŸ¥”", p:5.5, k:325, f:3, mode:'count', unit:'dosa', cat:'South Indian', veg:'Veg', tip:"Potato filling adds significant calories and carbs."},
  {name:"Idli (2pcs)", em:"âšª", p:3.5, k:120, f:1, mode:'count', unit:'plate', cat:'South Indian', veg:'Veg', tip:"Steamed and oil-free. Very healthy carb source."},
  {name:"Sambar", em:"ğŸ¥˜", p:3.5, k:90, f:3, mode:'count', unit:'bowl', cat:'South Indian', veg:'Veg', tip:"Loaded with veggies and lentils."},
  {name:"Curd Rice", em:"ğŸ¥£", p:9, k:275, f:0.5, mode:'count', unit:'bowl', cat:'South Indian', veg:'Veg', tip:"Excellent probiotic and cooling for stomach."},
  {name:"Sambar Rice", em:"ğŸ›", p:7, k:265, f:3, mode:'count', unit:'bowl', cat:'South Indian', veg:'Veg', tip:"Complete amino acid profile (grain+legume)."},

  // â”€â”€ VEG & FRUITS â”€â”€
  {name:"Banana", em:"ğŸŒ", p:1.1, k:105, f:2.6, mode:'count', unit:'banana', cat:'Fruits', veg:'Veg', tip:"Potassium powerhouse. Take 2-3 before workouts for energy."},
  {name:"Mango", em:"ğŸ¥­", p:0.8, k:60, f:1.6, mode:'gram', cat:'Fruits', veg:'Veg', tip:"High sugar content. Enjoy seasonally but limit quantity."},
  {name:"Guava", em:"ğŸˆ", p:2.6, k:68, f:5.4, mode:'count', unit:'guava', cat:'Fruits', veg:'Veg', tip:"One of the highest fiber fruits. Great for digestion."},
  {name:"Apple", em:"ğŸ", p:0.3, k:52, f:2.4, mode:'count', unit:'apple', cat:'Fruits', veg:'Veg', tip:"Pectin fiber helps keep you full."},
  {name:"Potato (Boiled)", em:"ğŸ¥”", p:2, k:87, f:1.8, mode:'gram', cat:'Grains & Veg', veg:'Veg', tip:"Cooled potatoes have resistant starch (good for gut)."},
  {name:"Bhindi (Okra)", em:"ğŸŒ¿", p:1.9, k:33, f:3.2, mode:'gram', cat:'Grains & Veg', veg:'Veg', tip:"Low calorie volume food. High soluble fiber."},
  {name:"Broccoli", em:"ğŸ¥¦", p:2.8, k:34, f:2.6, mode:'gram', cat:'Grains & Veg', veg:'Veg', tip:"Micronutrient powerhouse. Vitamin C & K."},
  {name:"Spinach", em:"ğŸŒ¿", p:2.9, k:23, f:2.2, mode:'gram', cat:'Grains & Veg', veg:'Veg', tip:"Iron rich. Low calorie volume food."},

  // â”€â”€ STREET FOOD & SNACKS â”€â”€
  {name:"Samosa", em:"ğŸ¥Ÿ", p:3.5, k:275, f:1, mode:'count', unit:'pc', cat:'Street Food', veg:'Veg', tip:"High calorie density (fried). Avoid if cutting fat."},
  {name:"Kachori", em:"ğŸ˜", p:4.5, k:225, f:1.5, mode:'count', unit:'pc', cat:'Street Food', veg:'Veg', tip:"Deep fried lentil snack. High fat."},
  {name:"Aloo Tikki", em:"ğŸ¥”", p:2, k:175, f:1.5, mode:'count', unit:'pc', cat:'Street Food', veg:'Veg', tip:"Fried potato. Low protein."},
  {name:"Aloo Chaat", em:"ğŸ¥—", p:3.5, k:325, f:3, mode:'count', unit:'plate', cat:'Street Food', veg:'Veg', tip:"Better than deep fried snacks if made with less oil."},
  {name:"Pani Puri (5pcs)", em:"ğŸ«§", p:2, k:135, f:1, mode:'count', unit:'plate', cat:'Street Food', veg:'Veg', tip:"Low protein, mostly carb/water. Treat food."},
  {name:"French Fries (100g)", em:"ğŸŸ", p:3.5, k:320, f:3, mode:'gram', cat:'Street Food', veg:'Veg', tip:"Very high calorie density due to oil absorption."},
  {name:"Dhokla", em:"ğŸŸ¨", p:6, k:160, f:1.2, mode:'count', unit:'plate', cat:'Snacks', veg:'Veg', tip:"Steamed and fermented. Healthier snack option."},
  {name:"Bhujia", em:"ğŸœ", p:12, k:550, f:10, mode:'gram', cat:'Snacks', veg:'Veg', tip:"High protein from Besan but deep fried. Eat small portions."},
  {name:"Veg Momos (Steamed)", em:"ğŸ¥Ÿ", p:6, k:225, f:1.5, mode:'count', unit:'plate', cat:'Chinese/Momos', veg:'Veg', tip:"Steamed is healthier. 6pcs per plate."},
  {name:"Veg Momos (Fried)", em:"ğŸ¥Ÿ", p:6, k:400, f:1.5, mode:'count', unit:'plate', cat:'Chinese/Momos', veg:'Veg', tip:"Avoid fried momos - nearly double the calories."},
  {name:"Chicken Momos", em:"ğŸ—", p:13.5, k:325, f:1, mode:'count', unit:'plate', cat:'Chinese/Momos', veg:'Non-Veg', tip:"Good protein content for a snack."},
  {name:"Veg Noodles", em:"ğŸœ", p:9, k:500, f:3, mode:'count', unit:'plate', cat:'Chinese/Momos', veg:'Veg', tip:"High carb and usually high sodium."},

  // â”€â”€ EXTRAS â”€â”€
  {name:"Tofu", em:"â¬œ", p:10, k:76, f:1, mode:'gram', cat:'Protein', veg:'Veg', tip:"Lean vegan protein. Low calorie alternative to paneer."},
  {name:"Peanut Butter", em:"ğŸ¥œ", p:4, k:95, f:1, mode:'count', unit:'tbsp', cat:'Snacks', veg:'Veg', tip:"Healthy fats & protein. Good on toast or in shakes."},
  {name:"Almonds (10pcs)", em:"ğŸŒ°", p:2.5, k:70, f:1.5, mode:'count', unit:'srv', cat:'Snacks', veg:'Veg', tip:"Healthy fats & Vitamin E. Good for brain."},
  {name:"Peanuts", em:"ğŸ¥œ", p:26, k:567, f:9, mode:'gram', cat:'Snacks', veg:'Veg', tip:"Cheapest protein source. High calorie so measure portions."},
  {name:"Tea (Chai)", em:"â˜•", p:1, k:70, f:0, mode:'count', unit:'cup', cat:'Beverages', veg:'Veg', tip:"Relaxant. Watch sugar intake."},
  {name:"Lassi (Sweet)", em:"ğŸ¥¤", p:4, k:180, f:0, mode:'ml', cat:'Beverages', veg:'Veg', tip:"Probiotic but high sugar. Choose salted for health."}
];

const budgetPlans = {
  'Veg': {
    u120: [
      {n: "Soya Chunks (50g)", p: 26, note:"Highest value"}, 
      {n: "Milk (500ml)", p: 19, note:"Calcium + Prot"}, 
      {n: "Toor Dal (2 bowls)", p: 14, note:"Staple"}, 
      {n: "Peanuts (30g)", p: 8, note:"Healthy Fat"},
      {n: "Curd (100g)", p: 3, note:"Gut health"}
    ],
    u200: [
      {n: "Paneer (200g)", p: 36, note:"Main source"}, 
      {n: "Soya Chunks (40g)", p: 20, note:"Booster"}, 
      {n: "Milk (500ml)", p: 19, note:"Drink"}, 
      {n: "Dal + Rice", p: 12, note:"Meal"}, 
      {n: "Whey Sachet (1)", p: 24, note:"If deal avail"}
    ]
  },
  'Egg': {
    u120: [
      {n: "Eggs (6 Whole)", p: 37, note:"â‚¹42 approx"}, 
      {n: "Soya Chunks (30g)", p: 15, note:"Cheap boost"}, 
      {n: "Milk (250ml)", p: 9, note:"Drink"}, 
      {n: "Dal + Rice", p: 10, note:"Meal"}, 
      {n: "Bananas (2)", p: 2, note:"Energy"}
    ],
    u200: [
      {n: "Eggs (10 - 2 whole, 8 white)", p: 42, note:"Core"}, 
      {n: "Chicken Breast (100g)", p: 31, note:"Meat add"}, 
      {n: "Oats + Milk", p: 14, note:"Breakfast"}, 
      {n: "Bread/Roti", p: 8, note:"Carbs"}
    ]
  },
  'Non-Veg': {
    u120: [
      {n: "Chicken Breast (150g)", p: 46, note:"High value"}, 
      {n: "Eggs (2)", p: 12, note:"Add-on"}, 
      {n: "Dal + Rice", p: 12, note:"Filler"}, 
      {n: "Seasonal Fruit", p: 1, note:"Vit C"}
    ],
    u200: [
      {n: "Chicken Breast (250g)", p: 77, note:"Massive protein"}, 
      {n: "Eggs (4)", p: 25, note:"Breakfast"}, 
      {n: "Curd", p: 6, note:"Digestion"}, 
      {n: "Rice/Roti", p: 8, note:"Carbs"}
    ]
  }
};

const mealTimingData = {
  'Veg': [
    { t: "ğŸŒ… Breakfast (8:00 AM)", d: "Oats Porridge + Milk + Almonds + Whey (Optional). Complex carbs for sustained energy." },
    { t: "ğŸ¥ª Lunch (1:00 PM)", d: "Dal/Rajma + Roti/Rice + Curd + Salad. Complete protein combination." },
    { t: "ğŸ‹ï¸ Pre-Workout (5:00 PM)", d: "Banana + Black Coffee. Fast carbs for immediate fuel." },
    { t: "ğŸ’ª Post-Workout (7:00 PM)", d: "Whey Protein / Paneer / Soya chunks. Critical for recovery." },
    { t: "ğŸŒ™ Dinner (9:00 PM)", d: "Paneer/Tofu Stir-fry + Salad. Low carb, slow-digesting protein." }
  ],
  'Egg': [
    { t: "ğŸŒ… Breakfast (8:00 AM)", d: "3 Boiled Eggs (1 whole) + Toast/Oats. High bio-available protein start." },
    { t: "ğŸ¥ª Lunch (1:00 PM)", d: "Dal + Rice + 2 Egg Omelette. Fiber + Protein balance." },
    { t: "ğŸ‹ï¸ Pre-Workout (5:00 PM)", d: "Banana / Apple + Coffee. Energy boost." },
    { t: "ğŸ’ª Post-Workout (7:00 PM)", d: "4-5 Egg Whites / Whey Protein. Pure protein for repair." },
    { t: "ğŸŒ™ Dinner (9:00 PM)", d: "Egg Bhurji + Roti + Salad. Light on stomach, high protein." }
  ],
  'Non-Veg': [
    { t: "ğŸŒ… Breakfast (8:00 AM)", d: "Eggs + Toast / Chicken Sausage. Solid protein foundation." },
    { t: "ğŸ¥ª Lunch (1:00 PM)", d: "Chicken Breast/Curry + Rice + Salad. High protein density." },
    { t: "ğŸ‹ï¸ Pre-Workout (5:00 PM)", d: "Banana + Coffee. Glycogen top-up." },
    { t: "ğŸ’ª Post-Workout (7:00 PM)", d: "Whey Protein / Grilled Chicken. Max anabolic response." },
    { t: "ğŸŒ™ Dinner (9:00 PM)", d: "Grilled Fish / Chicken + Veggies. Lean protein, healthy fats (fish)." }
  ]
};

// STATE
let currentMeal = [];
let logTotalP = 0;
let selectedFoodIdx = 0;
let activeCat = 'All';

// INIT
function init(){
  renderCat();
  renderFoodGrid();
  selectFood(0);
  renderBudget('Veg');
  renderTiming('Veg');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CALCULATOR UI
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderCat(){
  document.getElementById('catScroll').innerHTML = categories.map(c => 
    `<button class="cat-chip ${c===activeCat?'active':''}" onclick="setCat('${c}')">${c}</button>`
  ).join('');
}
function setCat(c){ activeCat=c; renderCat(); filterFoods(); }

function renderFoodGrid(list=foodData){
  document.getElementById('foodGrid').innerHTML = list.map((f,i) => {
    const origIdx = foodData.indexOf(f);
    return `<div class="food-card ${selectedFoodIdx===origIdx?'selected':''}" onclick="selectFood(${origIdx})">
      <span class="em">${f.em}</span>
      <div class="fn">${f.name}</div>
      <div class="fp">${f.p}g P</div>
      <div class="fib">${f.f}g Fib</div>
    </div>`;
  }).join('');
}

function filterFoods(){
  const term = document.getElementById('searchInput').value.toLowerCase();
  // Filter entire database, regardless of initial view limit
  const list = foodData.filter(f => (activeCat==='All'||f.cat===activeCat) && f.name.toLowerCase().includes(term));
  renderFoodGrid(list);
}

function selectFood(idx){
  selectedFoodIdx = idx;
  renderFoodGrid();
  const f = foodData[idx];
  document.getElementById('nutrTipText').innerHTML = f.tip;
  document.getElementById('nutrTip').classList.add('vis');
  
  const inp = document.getElementById('weightInput');
  const unit = document.getElementById('qtyUnit');
  if(f.mode==='count'){ inp.value=1; unit.innerText=f.unit+'s'; renderQB([1,2,3,4,6]); }
  else if(f.mode==='ml'){ inp.value=200; unit.innerText='ml'; renderQB([100,200,250,500]); }
  else{ inp.value=100; unit.innerText='g'; renderQB([50,100,150,200]); }
  updatePreview();
}

function renderQB(arr){
  document.getElementById('quickBtns').innerHTML = arr.map(v=>`<button class="qb" onclick="setQty(${v})">${v}</button>`).join('');
}
function setQty(v){ document.getElementById('weightInput').value=v; updatePreview(); }
function adjQty(d){ const i=document.getElementById('weightInput'); i.value=Math.max(0.5, parseFloat(i.value)+d); updatePreview(); }

function updatePreview(){
  const f=foodData[selectedFoodIdx];
  const qty=parseFloat(document.getElementById('weightInput').value);
  const m=f.mode==='count'?qty:(qty/100);
  document.getElementById('prevName').innerText=`${f.em} ${f.name}`;
  document.getElementById('prevP').innerText=(f.p*m).toFixed(1)+'g';
  document.getElementById('prevC').innerText=Math.round(f.k*m);
  document.getElementById('prevF').innerText=(f.f*m).toFixed(1)+'g';
  document.getElementById('prevBar').classList.add('vis');
}

function addToMeal(){
  const f=foodData[selectedFoodIdx];
  const qty=parseFloat(document.getElementById('weightInput').value);
  const m=f.mode==='count'?qty:(qty/100);
  currentMeal.push({n:f.name, p:f.p*m, k:f.k*m, f:f.f*m, q:qty, u:f.mode==='count'?f.unit:(f.mode==='ml'?'ml':'g'), veg:f.veg});
  renderMeal();
  showToast('âœ… Added to Plate');
}

function renderMeal(){
  let tp=0, tc=0, tf=0;
  const el=document.getElementById('mealItems');
  if(!currentMeal.length){
    el.innerHTML='<div style="text-align:center;padding:30px;color:var(--mu);font-size:13px">Plate is empty.<br>Select a food to start.</div>';
    document.getElementById('analyzeBtn').style.display='none';
  } else {
    el.innerHTML = currentMeal.map((x,i)=>{
      tp+=x.p; tc+=x.k; tf+=x.f;
      return `<div class="ml-entry"><div class="me-if"><div style="font-weight:700;font-size:12px">${x.n}</div><div style="font-size:11px;color:var(--mu)">${x.q}${x.u}</div></div><div class="me-nu"><div>${x.p.toFixed(1)}g P</div></div><button class="me-del" onclick="remItem(${i})">Ã—</button></div>`;
    }).join('');
    document.getElementById('analyzeBtn').style.display='block';
  }
  document.getElementById('totalP').innerText=tp.toFixed(1);
  document.getElementById('totalC').innerText=Math.round(tc);
  document.getElementById('totalF').innerText=tf.toFixed(1);
}
function remItem(i){ currentMeal.splice(i,1); renderMeal(); }

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ANALYSIS & GAP LOGIC
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function analyzeAndLog(){
  let plateP = 0;
  currentMeal.forEach(x => plateP += x.p);
  logTotalP = plateP;
  
  const cont = document.getElementById('dailyLogContainer');
  cont.innerHTML = `<div class="ml-entry" style="background:#E8F5E9;padding:12px;border-radius:10px;"><div class="me-if"><b>Current Plate</b></div><div class="me-nu" style="color:var(--gr);font-weight:700;font-size:14px;">${plateP.toFixed(1)}g Protein</div></div>`;
  document.getElementById('logTotalP').innerText = logTotalP.toFixed(1)+'g';
  
  switchTab('diet');
}

function calcGap(){
  const w = parseFloat(document.getElementById('gapWeight').value) || 70;
  const dietType = document.getElementById('gapDiet').value;
  const target = w * 2;
  const gap = Math.max(0, target - logTotalP);
  
  const msgEl = document.getElementById('gapMsg');
  const sugEl = document.getElementById('gapSugList');
  const resEl = document.getElementById('gapResult');
  
  resEl.classList.add('vis');
  
  if(gap <= 0){
    msgEl.innerHTML = `ğŸ‰ Amazing! You hit ${logTotalP.toFixed(1)}g (Target: ${target}g)`;
    sugEl.innerHTML = '<div style="text-align:center;color:var(--gr)">Goal reached! Maintain this.</div>';
    return;
  }
  
  msgEl.innerHTML = `âš ï¸ Missing: <span style="color:#C62828">${gap.toFixed(1)}g</span> Protein<br><span style="font-size:11px;font-weight:400;color:var(--mu)">Target: ${target}g (2g/kg for ${w}kg)</span>`;
  
  let candidates = foodData.filter(f => {
    if(f.cat !== 'Protein') return false;
    if(dietType === 'Veg' && f.veg !== 'Veg') return false;
    if(dietType === 'Egg' && f.veg === 'Non-Veg') return false;
    return !currentMeal.some(m => m.n === f.name); 
  });
  
  candidates.sort((a,b) => b.p - a.p);
  const top3 = candidates.slice(0, 3);
  
  sugEl.innerHTML = top3.map(s => `
    <div class="gap-sug-item">
      <div style="font-size:24px">${s.em}</div>
      <div>
        <div style="font-weight:700;font-size:13px">${s.name}</div>
        <div style="font-size:11px;color:var(--mu)">+${s.p}g Prot per serv â€¢ ${s.veg}</div>
        <div style="font-size:10px;color:#1565C0;margin-top:2px;">${s.tip}</div>
      </div>
    </div>
  `).join('');
  
  if(top3.length === 0) {
    sugEl.innerHTML = '<div style="padding:10px;text-align:center">Add more quantity of your current items!</div>';
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// BUDGET PLANS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderBudget(type, btn){
  if(btn){
    document.querySelectorAll('#tab-budget .cat-chip').forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
  }
  const p = budgetPlans[type];
  const calcTot = (arr) => arr.reduce((acc, curr)=>acc+curr.p, 0);
  
  const html = `
    <div class="budget-card">
      <div class="bc-hdr u120">Under â‚¹120 / Day</div>
      <div class="bc-body">
        ${p.u120.map(x=>`<div class="bc-row"><span>${x.n}</span><div style="text-align:right"><strong>${x.p}g P</strong><div style="font-size:9px;color:var(--mu)">${x.note}</div></div></div>`).join('')}
        <div class="bc-total"><span>Total Protein</span><span>~${calcTot(p.u120)}g</span></div>
      </div>
    </div>
    <div class="budget-card">
      <div class="bc-hdr u200">Under â‚¹200 / Day</div>
      <div class="bc-body">
        ${p.u200.map(x=>`<div class="bc-row"><span>${x.n}</span><div style="text-align:right"><strong>${x.p}g P</strong><div style="font-size:9px;color:var(--mu)">${x.note}</div></div></div>`).join('')}
        <div class="bc-total"><span>Total Protein</span><span>~${calcTot(p.u200)}g</span></div>
      </div>
    </div>
  `;
  document.getElementById('budgetContainer').innerHTML = html;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MEAL TIMING RENDERER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderTiming(type, btn){
  if(btn){
    document.querySelectorAll('#tab-timing .cat-chip').forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
  }
  const data = mealTimingData[type];
  document.getElementById('timingContainer').innerHTML = data.map(m => `
    <div class="ml-entry">
      <div class="me-if">
        <div style="font-weight:700">${m.t}</div>
        <div style="font-size:11px;color:var(--mu);margin-top:4px;line-height:1.4">${m.d}</div>
      </div>
    </div>
  `).join('');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// BMI
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function calcBMI(){
  const w = parseFloat(document.getElementById('bmiW').value);
  const h = parseFloat(document.getElementById('bmiH').value);
  if(!w || !h) return;
  
  const hM = h/100;
  const bmi = (w / (hM*hM)).toFixed(1);
  
  let cat = '', msg = '';
  if(bmi<18.5){ cat='Underweight'; msg='Calorie surplus needed. Add shakes, nuts, and healthy fats.'; }
  else if(bmi<25){ cat='Normal'; msg='Great! Maintain with 1.5g protein/kg and resistance training.'; }
  else if(bmi<30){ cat='Overweight'; msg='Slight deficit needed. Cut sugar, increase fiber (salad) and protein.'; }
  else{ cat='Obese'; msg='High protein diet + 500 kcal deficit. Focus on volume eating (veggies).'; }
  
  document.getElementById('bmiVal').innerText = bmi;
  document.getElementById('bmiCat').innerText = cat;
  document.getElementById('bmiMsg').innerText = msg;
  document.getElementById('bmiResultBox').classList.add('vis');
}

// UTILS
function switchTab(t, btn){
  document.querySelectorAll('.tab-panel').forEach(p=>p.classList.remove('active'));
  document.getElementById('tab-'+t).classList.add('active');
  if(btn){
    document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
  }
  window.scrollTo(0,0);
}

function showToast(msg){
  const t = document.getElementById('toast');
  t.innerText = msg;
  t.classList.add('show');
  setTimeout(()=>t.classList.remove('show'), 2500);
}

// Init
init();
</script>
</body>
</html>
